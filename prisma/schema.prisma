generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String   @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @default(now()) @updatedAt @map("updated_at")
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model EmailVerificationToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String   @map("user_id")
  expires   DateTime
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("email_verification_tokens")
}

model User {
  id                      String                   @id @default(cuid())
  name                    String?
  email                   String                   @unique
  emailVerified           DateTime?                @map("email_verified")
  image                   String?
  role                    UserRole                 @default(ROLE_WEDDING_OWNER)
  status                  UserStatus               @default(ACTIVE)
  plan                    PlanTier                 @default(FREE)
  createdAt               DateTime                 @default(now()) @map("created_at")
  updatedAt               DateTime                 @default(now()) @updatedAt @map("updated_at")
  locale                  String                   @default("he")
  roles                   UserRole[]               @default([ROLE_WEDDING_OWNER])
  password                String?
  stripeCurrentPeriodEnd  DateTime?                @map("stripe_current_period_end")
  stripeCustomerId        String?                  @unique @map("stripe_customer_id")
  stripePriceId           String?                  @map("stripe_price_id")
  stripeSubscriptionId    String?                  @unique @map("stripe_subscription_id")
  pendingPlanChange       PlanTier?                @map("pending_plan_change")
  pendingPlanChangeDate   DateTime?                @map("pending_plan_change_date")
  accounts                Account[]
  bulkMessageJobs         BulkMessageJob[]
  emailVerificationTokens EmailVerificationToken[]
  rsvpTemplates           RsvpTemplate[]
  sessions                Session[]
  usageTracking           UsageTracking?
  vapiCallJobs            VapiCallJob[]
  weddingEvents           WeddingEvent[]

  @@map("users")
}

model UsageTracking {
  id              String    @id @default(cuid())
  userId          String    @unique @map("user_id")
  whatsappSent    Int       @default(0) @map("whatsapp_sent")
  smsSent         Int       @default(0) @map("sms_sent")
  whatsappBonus   Int       @default(0) @map("whatsapp_bonus")
  smsBonus        Int       @default(0) @map("sms_bonus")
  periodStart     DateTime  @default(now()) @map("period_start")
  periodEnd       DateTime? @map("period_end")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @default(now()) @updatedAt @map("updated_at")
  voiceCallsBonus Int       @default(0) @map("voice_calls_bonus")
  voiceCallsMade  Int       @default(0) @map("voice_calls_made")
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("usage_tracking")
}

model WeddingEvent {
  id                      String             @id @default(cuid())
  ownerId                 String             @map("owner_id")
  title                   String
  description             String?
  dateTime                DateTime           @map("date_time")
  location                String
  venue                   String?
  notes                   String?
  imageUrl                String?            @map("image_url")
  isActive                Boolean            @default(true) @map("is_active")
  createdAt               DateTime           @default(now()) @map("created_at")
  updatedAt               DateTime           @default(now()) @updatedAt @map("updated_at")
  smsSenderId             String?            @map("sms_sender_id")
  invitationImagePublicId String?            @map("invitation_image_public_id")
  invitationImageUrl      String?            @map("invitation_image_url")
  totalBudget             Decimal?           @map("total_budget") @db.Decimal(10, 2)
  bulkMessageJobs         BulkMessageJob[]
  guests                  Guest[]
  messageTemplates        MessageTemplate[]
  rsvpPageSettings        RsvpPageSettings?
  suppliers               Supplier[]
  vapiSettings            VapiEventSettings?
  venueBlocks             VenueBlock[]
  owner                   User               @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  tables                  WeddingTable[]

  @@index([ownerId])
  @@map("wedding_events")
}

model Guest {
  id                  String                   @id @default(cuid())
  weddingEventId      String                   @map("wedding_event_id")
  name                String
  phoneNumber         String?                  @map("phone_number")
  email               String?
  slug                String                   @unique
  side                String?
  groupName           String?                  @map("group_name")
  notes               String?
  createdAt           DateTime                 @default(now()) @map("created_at")
  updatedAt           DateTime                 @default(now()) @updatedAt @map("updated_at")
  expectedGuests      Int                      @default(1) @map("expected_guests")
  bulkMessageJobItems BulkMessageJobItem[]
  rsvp                GuestRsvp?
  weddingEvent        WeddingEvent             @relation(fields: [weddingEventId], references: [id], onDelete: Cascade)
  notificationLogs    NotificationLog[]
  tableAssignment     TableAssignment?
  vapiCallLogs        VapiCallLog[]
  whatsappResponses   WhatsAppButtonResponse[]

  @@index([weddingEventId])
  @@index([slug])
  @@map("guests")
}

model GuestRsvp {
  id          String     @id @default(cuid())
  guestId     String     @unique @map("guest_id")
  status      RsvpStatus @default(PENDING)
  guestCount  Int        @default(1) @map("guest_count")
  note        String?
  respondedAt DateTime?  @map("responded_at")
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @default(now()) @updatedAt @map("updated_at")
  guest       Guest      @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@map("guest_rsvps")
}

model NotificationLog {
  id               String              @id @default(cuid())
  guestId          String              @map("guest_id")
  type             NotificationType
  channel          NotificationChannel
  status           NotificationStatus  @default(PENDING)
  providerResponse String?             @map("provider_response")
  sentAt           DateTime?           @map("sent_at")
  deliveredAt      DateTime?           @map("delivered_at")
  createdAt        DateTime            @default(now()) @map("created_at")
  guest            Guest               @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([guestId])
  @@index([type, status])
  @@map("notification_logs")
}

model RsvpPageSettings {
  id                           String           @id @default(cuid())
  weddingEventId               String           @unique @map("wedding_event_id")
  backgroundType               BackgroundType   @default(IMAGE) @map("background_type")
  backgroundColor              String?          @map("background_color")
  backgroundImage              String?          @map("background_image")
  backgroundOverlay            Float?           @map("background_overlay")
  primaryColor                 String?          @map("primary_color")
  secondaryColor               String?          @map("secondary_color")
  textColor                    String?          @map("text_color")
  fontFamily                   String?          @map("font_family")
  cardStyle                    CardStyle        @default(GLASS) @map("card_style")
  cardBackground               String?          @map("card_background")
  cardBorderRadius             Int?             @map("card_border_radius")
  welcomeTitle                 String?          @map("welcome_title")
  welcomeMessage               String?          @map("welcome_message")
  thankYouMessage              String?          @map("thank_you_message")
  createdAt                    DateTime         @default(now()) @map("created_at")
  updatedAt                    DateTime         @default(now()) @updatedAt @map("updated_at")
  accentColor                  String?          @map("accent_color")
  backgroundBlur               Int?             @map("background_blur")
  buttonBorderRadius           Int?             @map("button_border_radius")
  buttonColor                  String?          @map("button_color")
  buttonStyle                  String?          @map("button_style")
  buttonTextColor              String?          @map("button_text_color")
  cardMaxWidth                 Int?             @map("card_max_width")
  cardOpacity                  Float?           @map("card_opacity")
  cardPadding                  Int?             @map("card_padding")
  declineMessage               String?          @map("decline_message")
  showGoogleMaps               Boolean          @default(true) @map("show_google_maps")
  cardBlur                     Int?             @map("card_blur")
  pageLocale                   String           @default("he") @map("page_locale")
  googleMapsUrl                String?          @map("google_maps_url")
  showWaze                     Boolean          @default(true) @map("show_waze")
  wazeUrl                      String?          @map("waze_url")
  inputBackgroundColor         String?          @map("input_background_color")
  inputBorderColor             String?          @map("input_border_color")
  inputTextColor               String?          @map("input_text_color")
  labelTextColor               String?          @map("label_text_color")
  subtitleTextColor            String?          @map("subtitle_text_color")
  buttonBorderColor            String?          @map("button_border_color")
  buttonShadow                 Boolean          @default(true) @map("button_shadow")
  buttonSize                   String?          @map("button_size")
  dateCardAccentColor          String?          @map("date_card_accent_color")
  dateCardBackground           String?          @map("date_card_background")
  dateCardBorderRadius         Int?             @map("date_card_border_radius")
  dateCardTextColor            String?          @map("date_card_text_color")
  dateDisplayStyle             DateDisplayStyle @default(CALENDAR) @map("date_display_style")
  showCountdown                Boolean          @default(true) @map("show_countdown")
  guestCounterAccent           String?          @map("guest_counter_accent")
  guestCounterBackground       String?          @map("guest_counter_background")
  guestCounterTextColor        String?          @map("guest_counter_text_color")
  buttonFontSize               Int?             @map("button_font_size")
  labelFontSize                Int?             @map("label_font_size")
  subtitleFontSize             Int?             @map("subtitle_font_size")
  titleFontSize                Int?             @map("title_font_size")
  acceptButtonColor            String?          @map("accept_button_color")
  acceptButtonTextColor        String?          @map("accept_button_text_color")
  addressFontSize              Int?             @map("address_font_size")
  addressSectionBackground     String?          @map("address_section_background")
  addressSectionBorderRadius   Int?             @map("address_section_border_radius")
  addressSectionTextColor      String?          @map("address_section_text_color")
  countdownBoxBackground       String?          @map("countdown_box_background")
  countdownBoxTextColor        String?          @map("countdown_box_text_color")
  countdownLabelColor          String?          @map("countdown_label_color")
  countdownNumberFontSize      Int?             @map("countdown_number_font_size")
  countdownSectionBackground   String?          @map("countdown_section_background")
  countdownSectionBorderRadius Int?             @map("countdown_section_border_radius")
  countdownSectionTextColor    String?          @map("countdown_section_text_color")
  dateCardBackgroundImage      String?          @map("date_card_background_image")
  dateCardBlur                 Int?             @map("date_card_blur")
  dateCardOverlay              Float?           @map("date_card_overlay")
  dateCardPadding              Int?             @map("date_card_padding")
  dateCardShadow               Boolean          @default(true) @map("date_card_shadow")
  dateDayFontSize              Int?             @map("date_day_font_size")
  dateMonthFontSize            Int?             @map("date_month_font_size")
  dateYearFontSize             Int?             @map("date_year_font_size")
  declineButtonColor           String?          @map("decline_button_color")
  declineButtonTextColor       String?          @map("decline_button_text_color")
  questionFontSize             Int?             @map("question_font_size")
  questionSectionBackground    String?          @map("question_section_background")
  questionSectionBorderRadius  Int?             @map("question_section_border_radius")
  questionTextColor            String?          @map("question_text_color")
  showAddressSection           Boolean          @default(true) @map("show_address_section")
  showTimeSection              Boolean          @default(true) @map("show_time_section")
  timeFontSize                 Int?             @map("time_font_size")
  timeSectionBackground        String?          @map("time_section_background")
  timeSectionBorderRadius      Int?             @map("time_section_border_radius")
  timeSectionTextColor         String?          @map("time_section_text_color")
  advancedMode                 Boolean          @default(false) @map("advanced_mode")
  cardBorderColor              String?          @map("card_border_color")
  cardBorderWidth              Int?             @map("card_border_width")
  cardShadow                   Boolean          @default(true) @map("card_shadow")
  addressIconColor             String?          @map("address_icon_color")
  countdownLabelFontSize       Int?             @map("countdown_label_font_size")
  dateDayNumberColor           String?          @map("date_day_number_color")
  dateDayOfWeekColor           String?          @map("date_day_of_week_color")
  dateDayOfWeekFontSize        Int?             @map("date_day_of_week_font_size")
  dateMonthYearColor           String?          @map("date_month_year_color")
  timeIconColor                String?          @map("time_icon_color")
  welcomeMessageColor          String?          @map("welcome_message_color")
  welcomeMessageFontSize       Int?             @map("welcome_message_font_size")
  welcomeTitleColor            String?          @map("welcome_title_color")
  welcomeTitleFontSize         Int?             @map("welcome_title_font_size")
  guestCounterButtonColor      String?          @map("guest_counter_button_color")
  rsvpAcceptBackground         String?          @map("rsvp_accept_background")
  rsvpAcceptTextColor          String?          @map("rsvp_accept_text_color")
  rsvpDeclineBackground        String?          @map("rsvp_decline_background")
  rsvpDeclineTextColor         String?          @map("rsvp_decline_text_color")
  titleTextColor               String?          @map("title_text_color")
  rsvpButtonFontSize           Int?             @map("rsvp_button_font_size")
  weddingEvent                 WeddingEvent     @relation(fields: [weddingEventId], references: [id], onDelete: Cascade)

  @@map("rsvp_page_settings")
}

model RsvpTemplate {
  id                           String           @id @default(cuid())
  name                         String
  description                  String?
  previewUrl                   String?          @map("preview_url")
  isSystem                     Boolean          @default(false) @map("is_system")
  ownerId                      String?          @map("owner_id")
  backgroundType               BackgroundType   @default(IMAGE) @map("background_type")
  backgroundColor              String?          @map("background_color")
  backgroundImage              String?          @map("background_image")
  backgroundOverlay            Float?           @map("background_overlay")
  backgroundBlur               Int?             @map("background_blur")
  primaryColor                 String?          @map("primary_color")
  secondaryColor               String?          @map("secondary_color")
  textColor                    String?          @map("text_color")
  accentColor                  String?          @map("accent_color")
  fontFamily                   String?          @map("font_family")
  cardStyle                    CardStyle        @default(GLASS) @map("card_style")
  cardBackground               String?          @map("card_background")
  cardBorderRadius             Int?             @map("card_border_radius")
  cardPadding                  Int?             @map("card_padding")
  cardMaxWidth                 Int?             @map("card_max_width")
  cardOpacity                  Float?           @map("card_opacity")
  showGoogleMaps               Boolean          @default(true) @map("show_google_maps")
  welcomeTitle                 String?          @map("welcome_title")
  welcomeMessage               String?          @map("welcome_message")
  thankYouMessage              String?          @map("thank_you_message")
  declineMessage               String?          @map("decline_message")
  buttonStyle                  String?          @map("button_style")
  buttonColor                  String?          @map("button_color")
  buttonTextColor              String?          @map("button_text_color")
  buttonBorderRadius           Int?             @map("button_border_radius")
  createdAt                    DateTime         @default(now()) @map("created_at")
  updatedAt                    DateTime         @default(now()) @updatedAt @map("updated_at")
  cardBlur                     Int?             @map("card_blur")
  pageLocale                   String           @default("he") @map("page_locale")
  showWaze                     Boolean          @default(true) @map("show_waze")
  inputBackgroundColor         String?          @map("input_background_color")
  inputBorderColor             String?          @map("input_border_color")
  inputTextColor               String?          @map("input_text_color")
  labelTextColor               String?          @map("label_text_color")
  subtitleTextColor            String?          @map("subtitle_text_color")
  buttonBorderColor            String?          @map("button_border_color")
  buttonShadow                 Boolean          @default(true) @map("button_shadow")
  buttonSize                   String?          @map("button_size")
  dateCardAccentColor          String?          @map("date_card_accent_color")
  dateCardBackground           String?          @map("date_card_background")
  dateCardBorderRadius         Int?             @map("date_card_border_radius")
  dateCardTextColor            String?          @map("date_card_text_color")
  dateDisplayStyle             DateDisplayStyle @default(CALENDAR) @map("date_display_style")
  showCountdown                Boolean          @default(true) @map("show_countdown")
  guestCounterAccent           String?          @map("guest_counter_accent")
  guestCounterBackground       String?          @map("guest_counter_background")
  guestCounterTextColor        String?          @map("guest_counter_text_color")
  buttonFontSize               Int?             @map("button_font_size")
  labelFontSize                Int?             @map("label_font_size")
  subtitleFontSize             Int?             @map("subtitle_font_size")
  titleFontSize                Int?             @map("title_font_size")
  acceptButtonColor            String?          @map("accept_button_color")
  acceptButtonTextColor        String?          @map("accept_button_text_color")
  addressFontSize              Int?             @map("address_font_size")
  addressSectionBackground     String?          @map("address_section_background")
  addressSectionBorderRadius   Int?             @map("address_section_border_radius")
  addressSectionTextColor      String?          @map("address_section_text_color")
  countdownBoxBackground       String?          @map("countdown_box_background")
  countdownBoxTextColor        String?          @map("countdown_box_text_color")
  countdownLabelColor          String?          @map("countdown_label_color")
  countdownNumberFontSize      Int?             @map("countdown_number_font_size")
  countdownSectionBackground   String?          @map("countdown_section_background")
  countdownSectionBorderRadius Int?             @map("countdown_section_border_radius")
  countdownSectionTextColor    String?          @map("countdown_section_text_color")
  dateCardBackgroundImage      String?          @map("date_card_background_image")
  dateCardBlur                 Int?             @map("date_card_blur")
  dateCardOverlay              Float?           @map("date_card_overlay")
  dateCardPadding              Int?             @map("date_card_padding")
  dateCardShadow               Boolean          @default(true) @map("date_card_shadow")
  dateDayFontSize              Int?             @map("date_day_font_size")
  dateMonthFontSize            Int?             @map("date_month_font_size")
  dateYearFontSize             Int?             @map("date_year_font_size")
  declineButtonColor           String?          @map("decline_button_color")
  declineButtonTextColor       String?          @map("decline_button_text_color")
  questionFontSize             Int?             @map("question_font_size")
  questionSectionBackground    String?          @map("question_section_background")
  questionSectionBorderRadius  Int?             @map("question_section_border_radius")
  questionTextColor            String?          @map("question_text_color")
  showAddressSection           Boolean          @default(true) @map("show_address_section")
  showTimeSection              Boolean          @default(true) @map("show_time_section")
  timeFontSize                 Int?             @map("time_font_size")
  timeSectionBackground        String?          @map("time_section_background")
  timeSectionBorderRadius      Int?             @map("time_section_border_radius")
  timeSectionTextColor         String?          @map("time_section_text_color")
  advancedMode                 Boolean          @default(false) @map("advanced_mode")
  cardBorderColor              String?          @map("card_border_color")
  cardBorderWidth              Int?             @map("card_border_width")
  cardShadow                   Boolean          @default(true) @map("card_shadow")
  addressIconColor             String?          @map("address_icon_color")
  countdownLabelFontSize       Int?             @map("countdown_label_font_size")
  dateDayNumberColor           String?          @map("date_day_number_color")
  dateDayOfWeekColor           String?          @map("date_day_of_week_color")
  dateDayOfWeekFontSize        Int?             @map("date_day_of_week_font_size")
  dateMonthYearColor           String?          @map("date_month_year_color")
  timeIconColor                String?          @map("time_icon_color")
  welcomeMessageColor          String?          @map("welcome_message_color")
  welcomeMessageFontSize       Int?             @map("welcome_message_font_size")
  welcomeTitleColor            String?          @map("welcome_title_color")
  welcomeTitleFontSize         Int?             @map("welcome_title_font_size")
  owner                        User?            @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([ownerId])
  @@index([isSystem])
  @@map("rsvp_templates")
}

model MessagingProviderSettings {
  id                               String   @id @default(cuid())
  whatsappProvider                 String?  @map("whatsapp_provider")
  whatsappApiKey                   String?  @map("whatsapp_api_key")
  whatsappApiSecret                String?  @map("whatsapp_api_secret")
  whatsappPhoneNumber              String?  @map("whatsapp_phone_number")
  whatsappEnabled                  Boolean  @default(false) @map("whatsapp_enabled")
  smsProvider                      String?  @map("sms_provider")
  smsApiKey                        String?  @map("sms_api_key")
  smsApiSecret                     String?  @map("sms_api_secret")
  smsPhoneNumber                   String?  @map("sms_phone_number")
  smsEnabled                       Boolean  @default(false) @map("sms_enabled")
  createdAt                        DateTime @default(now()) @map("created_at")
  updatedAt                        DateTime @default(now()) @updatedAt @map("updated_at")
  smsMessagingServiceSid           String?  @map("sms_messaging_service_sid")
  whatsappConfirmationContentSid   String?  @map("whatsapp_confirmation_content_sid")
  whatsappInviteContentSid         String?  @map("whatsapp_invite_content_sid")
  whatsappReminderContentSid       String?  @map("whatsapp_reminder_content_sid")
  whatsappConfirmationTemplateText String?  @map("whatsapp_confirmation_template_text")
  whatsappInviteTemplateText       String?  @map("whatsapp_invite_template_text")
  whatsappReminderTemplateText     String?  @map("whatsapp_reminder_template_text")
  whatsappImageInviteContentSid    String?  @map("whatsapp_image_invite_content_sid")
  azureSpeechKey                   String?  @map("azure_speech_key")
  azureSpeechRegion                String?  @map("azure_speech_region")
  vapiApiKey                       String?  @map("vapi_api_key")
  vapiAssistantId                  String?  @map("vapi_assistant_id")
  vapiDefaultFirstMessage          String?  @map("vapi_default_first_message")
  vapiDefaultSystemPrompt          String?  @map("vapi_default_system_prompt")
  vapiDefaultVoiceId               String?  @default("he-IL-AvriNeural") @map("vapi_default_voice_id")
  vapiEnabled                      Boolean  @default(false) @map("vapi_enabled")
  vapiPhoneNumber                  String?  @map("vapi_phone_number")
  vapiPhoneNumberId                String?  @map("vapi_phone_number_id")
  vapiWebhookSecret                String?  @map("vapi_webhook_secret")

  // Interactive Button Templates
  whatsappInteractiveInviteContentSid   String? @map("whatsapp_interactive_invite_content_sid")
  whatsappInteractiveReminderContentSid String? @map("whatsapp_interactive_reminder_content_sid")
  whatsappGuestCountListContentSid      String? @map("whatsapp_guest_count_list_content_sid")

  // Interactive template text for display
  whatsappInteractiveInviteText    String? @map("whatsapp_interactive_invite_text")
  whatsappInteractiveReminderText  String? @map("whatsapp_interactive_reminder_text")

  // Related phone numbers
  whatsappPhoneNumbers WhatsAppPhoneNumber[]

  @@map("messaging_provider_settings")
}

model MessageTemplate {
  id                String           @id @default(cuid())
  weddingEventId    String           @map("wedding_event_id")
  type              NotificationType
  locale            String           @default("he")
  title             String
  message           String
  isAcceptedVariant Boolean          @default(false) @map("is_accepted_variant")
  isActive          Boolean          @default(true) @map("is_active")
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @default(now()) @updatedAt @map("updated_at")
  weddingEvent      WeddingEvent     @relation(fields: [weddingEventId], references: [id], onDelete: Cascade)

  @@unique([weddingEventId, type, locale, isAcceptedVariant])
  @@index([weddingEventId])
  @@map("message_templates")
}

model BulkMessageJob {
  id             String               @id @default(cuid())
  weddingEventId String               @map("wedding_event_id")
  createdBy      String               @map("created_by")
  messageType    NotificationType
  channel        NotificationChannel?
  status         BulkJobStatus        @default(PENDING)
  totalGuests    Int                  @map("total_guests")
  processedCount Int                  @default(0) @map("processed_count")
  successCount   Int                  @default(0) @map("success_count")
  failedCount    Int                  @default(0) @map("failed_count")
  startedAt      DateTime?            @map("started_at")
  completedAt    DateTime?            @map("completed_at")
  createdAt      DateTime             @default(now()) @map("created_at")
  errorMessage   String?              @map("error_message")
  items          BulkMessageJobItem[]
  creator        User                 @relation(fields: [createdBy], references: [id])
  weddingEvent   WeddingEvent         @relation(fields: [weddingEventId], references: [id], onDelete: Cascade)

  @@index([weddingEventId])
  @@index([createdBy])
  @@index([status])
  @@map("bulk_message_jobs")
}

model BulkMessageJobItem {
  id           String             @id @default(cuid())
  jobId        String             @map("job_id")
  guestId      String             @map("guest_id")
  status       NotificationStatus @default(PENDING)
  attempts     Int                @default(0)
  sentAt       DateTime?          @map("sent_at")
  errorMessage String?            @map("error_message")
  guest        Guest              @relation(fields: [guestId], references: [id], onDelete: Cascade)
  job          BulkMessageJob     @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([jobId])
  @@index([guestId])
  @@index([status])
  @@map("bulk_message_job_items")
}

model WeddingTable {
  id             String            @id @default(cuid())
  weddingEventId String            @map("wedding_event_id")
  name           String
  capacity       Int               @default(10)
  positionX      Int?              @map("position_x")
  positionY      Int?              @map("position_y")
  shape          String?           @default("circle")
  createdAt      DateTime          @default(now()) @map("created_at")
  updatedAt      DateTime          @default(now()) @updatedAt @map("updated_at")
  height         Int               @default(100)
  width          Int               @default(100)
  rotation       Int               @default(0)
  assignments    TableAssignment[]
  weddingEvent   WeddingEvent      @relation(fields: [weddingEventId], references: [id], onDelete: Cascade)

  @@index([weddingEventId])
  @@map("wedding_tables")
}

model TableAssignment {
  id        String       @id @default(cuid())
  tableId   String       @map("table_id")
  guestId   String       @unique @map("guest_id")
  createdAt DateTime     @default(now()) @map("created_at")
  guest     Guest        @relation(fields: [guestId], references: [id], onDelete: Cascade)
  table     WeddingTable @relation(fields: [tableId], references: [id], onDelete: Cascade)

  @@unique([tableId, guestId])
  @@index([tableId])
  @@index([guestId])
  @@map("table_assignments")
}

model VenueBlock {
  id             String       @id @default(cuid())
  weddingEventId String       @map("wedding_event_id")
  name           String
  type           String
  positionX      Int?         @map("position_x")
  positionY      Int?         @map("position_y")
  width          Int          @default(100)
  height         Int          @default(100)
  rotation       Int          @default(0)
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @default(now()) @updatedAt @map("updated_at")
  shape          String       @default("rectangle")
  weddingEvent   WeddingEvent @relation(fields: [weddingEventId], references: [id], onDelete: Cascade)

  @@index([weddingEventId])
  @@map("venue_blocks")
}

model CronJobLog {
  id           String        @id @default(cuid())
  jobType      CronJobType   @map("job_type")
  status       CronJobStatus
  userId       String?       @map("user_id")
  userEmail    String?       @map("user_email")
  fromPlan     PlanTier?     @map("from_plan")
  toPlan       PlanTier?     @map("to_plan")
  scheduledFor DateTime?     @map("scheduled_for")
  executedAt   DateTime      @default(now()) @map("executed_at")
  message      String?
  errorDetails String?       @map("error_details")
  createdAt    DateTime      @default(now()) @map("created_at")

  @@index([jobType])
  @@index([status])
  @@index([userId])
  @@index([executedAt])
  @@map("cron_job_logs")
}

model VapiEventSettings {
  id                 String          @id @default(cuid())
  weddingEventId     String          @unique @map("wedding_event_id")
  customSystemPrompt String?         @map("custom_system_prompt")
  customFirstMessage String?         @map("custom_first_message")
  voiceId            String?         @map("voice_id")
  isEnabled          Boolean         @default(true) @map("is_enabled")
  canUpdateRsvp      Boolean         @default(true) @map("can_update_rsvp")
  lastSyncAt         DateTime?       @map("last_sync_at")
  syncStatus         String?         @map("sync_status")
  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @default(now()) @updatedAt @map("updated_at")
  callJobs           VapiCallJob[]
  embeddings         VapiEmbedding[]
  weddingEvent       WeddingEvent    @relation(fields: [weddingEventId], references: [id], onDelete: Cascade)

  @@map("vapi_event_settings")
}

model VapiEmbedding {
  id             String            @id @default(cuid())
  vapiSettingsId String            @map("vapi_settings_id")
  contentType    String            @map("content_type")
  content        String
  createdAt      DateTime          @default(now()) @map("created_at")
  updatedAt      DateTime          @default(now()) @updatedAt @map("updated_at")
  vapiSettings   VapiEventSettings @relation(fields: [vapiSettingsId], references: [id], onDelete: Cascade)

  @@index([vapiSettingsId])
  @@index([contentType])
  @@map("vapi_embeddings")
}

model VapiCallJob {
  id             String            @id @default(cuid())
  weddingEventId String            @map("wedding_event_id")
  vapiSettingsId String            @map("vapi_settings_id")
  createdBy      String            @map("created_by")
  status         VapiJobStatus     @default(PENDING)
  totalGuests    Int               @map("total_guests")
  processedCount Int               @default(0) @map("processed_count")
  successCount   Int               @default(0) @map("success_count")
  failedCount    Int               @default(0) @map("failed_count")
  scheduledFor   DateTime?         @map("scheduled_for")
  startedAt      DateTime?         @map("started_at")
  completedAt    DateTime?         @map("completed_at")
  createdAt      DateTime          @default(now()) @map("created_at")
  errorMessage   String?           @map("error_message")
  creator        User              @relation(fields: [createdBy], references: [id])
  vapiSettings   VapiEventSettings @relation(fields: [vapiSettingsId], references: [id], onDelete: Cascade)
  callLogs       VapiCallLog[]

  @@index([weddingEventId])
  @@index([vapiSettingsId])
  @@index([createdBy])
  @@index([status])
  @@map("vapi_call_jobs")
}

model VapiCallLog {
  id             String         @id @default(cuid())
  callJobId      String?        @map("call_job_id")
  guestId        String         @map("guest_id")
  weddingEventId String         @map("wedding_event_id")
  vapiCallId     String?        @unique @map("vapi_call_id")
  phoneNumber    String         @map("phone_number")
  status         VapiCallStatus @default(PENDING)
  duration       Int?
  rsvpUpdated    Boolean        @default(false) @map("rsvp_updated")
  rsvpStatus     String?        @map("rsvp_status")
  guestCount     Int?           @map("guest_count")
  transcript     String?
  scheduledAt    DateTime?      @map("scheduled_at")
  startedAt      DateTime?      @map("started_at")
  endedAt        DateTime?      @map("ended_at")
  createdAt      DateTime       @default(now()) @map("created_at")
  callJob        VapiCallJob?   @relation(fields: [callJobId], references: [id])
  guest          Guest          @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([callJobId])
  @@index([guestId])
  @@index([weddingEventId])
  @@index([vapiCallId])
  @@index([status])
  @@map("vapi_call_logs")
}

model Supplier {
  id             String            @id @default(cuid())
  weddingEventId String            @map("wedding_event_id")
  name           String
  category       SupplierCategory
  status         SupplierStatus    @default(INQUIRY)
  contactName    String?           @map("contact_name")
  phoneNumber    String?           @map("phone_number")
  email          String?
  website        String?
  estimatedCost  Decimal?          @map("estimated_cost") @db.Decimal(10, 2)
  agreedPrice    Decimal?          @map("agreed_price") @db.Decimal(10, 2)
  currency       String            @default("ILS")
  notes          String?
  contractUrl    String?           @map("contract_url")
  bookedAt       DateTime?         @map("booked_at")
  createdAt      DateTime          @default(now()) @map("created_at")
  updatedAt      DateTime          @updatedAt @map("updated_at")
  payments       SupplierPayment[]
  weddingEvent   WeddingEvent      @relation(fields: [weddingEventId], references: [id], onDelete: Cascade)

  @@index([weddingEventId])
  @@index([category])
  @@index([status])
  @@map("suppliers")
}

model SupplierPayment {
  id          String        @id @default(cuid())
  supplierId  String        @map("supplier_id")
  amount      Decimal       @db.Decimal(10, 2)
  method      PaymentMethod @default(BANK_TRANSFER)
  description String?
  paidAt      DateTime      @map("paid_at")
  dueDate     DateTime?     @map("due_date")
  receiptUrl  String?       @map("receipt_url")
  notes       String?
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  supplier    Supplier      @relation(fields: [supplierId], references: [id], onDelete: Cascade)

  @@index([supplierId])
  @@index([dueDate])
  @@map("supplier_payments")
}

model WhatsAppPhoneNumber {
  id                         String                    @id @default(cuid())
  phoneNumber                String                    @unique @map("phone_number")
  displayName                String?                   @map("display_name")
  isActive                   Boolean                   @default(false) @map("is_active")
  messagingProviderSettingsId String?                  @map("messaging_provider_settings_id")
  createdAt                  DateTime                  @default(now()) @map("created_at")
  updatedAt                  DateTime                  @default(now()) @updatedAt @map("updated_at")
  messagingProviderSettings  MessagingProviderSettings? @relation(fields: [messagingProviderSettingsId], references: [id], onDelete: Cascade)

  @@index([isActive])
  @@map("whatsapp_phone_numbers")
}

model WhatsAppButtonResponse {
  id                String      @id @default(cuid())
  guestId           String      @map("guest_id")
  notificationLogId String?     @map("notification_log_id")
  responseType      String      @map("response_type") // "button" | "list"
  buttonId          String      @map("button_id")
  buttonTitle       String      @map("button_title")
  rsvpStatusSet     RsvpStatus? @map("rsvp_status_set")
  guestCountSet     Int?        @map("guest_count_set")
  processedAt       DateTime?   @map("processed_at")
  rawPayload        Json?       @map("raw_payload")
  createdAt         DateTime    @default(now()) @map("created_at")

  guest Guest @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([guestId])
  @@map("whatsapp_button_responses")
}

enum UserRole {
  ROLE_PLATFORM_OWNER
  ROLE_WEDDING_OWNER
}

enum UserStatus {
  PENDING_APPROVAL
  ACTIVE
  SUSPENDED
}

enum PlanTier {
  FREE
  BASIC
  PREMIUM
  ADVANCED
  BUSINESS
}

enum RsvpStatus {
  PENDING
  ACCEPTED
  DECLINED
}

enum NotificationType {
  INVITE
  REMINDER
  CONFIRMATION
  IMAGE_INVITE
  INTERACTIVE_INVITE
  INTERACTIVE_REMINDER
  GUEST_COUNT_REQUEST
}

enum NotificationChannel {
  WHATSAPP
  SMS
  EMAIL
}

enum NotificationStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
}

enum BulkJobStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum BackgroundType {
  COLOR
  IMAGE
  GRADIENT
}

enum CardStyle {
  FLAT
  ELEVATED
  BORDERED
  GLASS
}

enum DateDisplayStyle {
  CARD
  CALENDAR
  MINIMAL
}

enum CronJobType {
  PLAN_CHANGE
  BULK_MESSAGE
}

enum CronJobStatus {
  SUCCESS
  FAILED
  SKIPPED
}

enum VapiCallStatus {
  PENDING
  CALLING
  COMPLETED
  FAILED
  NO_ANSWER
  BUSY
  CANCELLED
}

enum VapiJobStatus {
  PENDING
  PROCESSING
  COMPLETED
  CANCELLED
  FAILED
}

enum SupplierCategory {
  VENUE
  CATERING
  PHOTOGRAPHY
  VIDEOGRAPHY
  DJ_MUSIC
  FLOWERS
  DECORATIONS
  CAKE
  DRESS_ATTIRE
  MAKEUP_HAIR
  INVITATIONS
  TRANSPORTATION
  ACCOMMODATION
  RABBI_OFFICIANT
  OTHER
}

enum SupplierStatus {
  INQUIRY
  QUOTE_RECEIVED
  NEGOTIATING
  BOOKED
  DEPOSIT_PAID
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  BANK_TRANSFER
  CHECK
  OTHER
}
